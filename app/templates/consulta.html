{% extends "base.html" %}
{% block content %}

<h2>📦 Consulta de Stock</h2>

<form method="GET" action="{{ url_for('main.consultar_stock') }}">
    <label for="sku">Buscar por SKU, Nombre, EAN o DUN14:</label><br>
    <input type="text" id="sku" name="sku" placeholder="Ej: ABC123, silla, 789456..." value="{{ sku or '' }}">
    <button type="submit">🔍 Buscar</button>
</form>

<br>

{% if resultados %}
    <table>
        <tr>
            <th>SKU</th>
            <th>Nombre</th>
            <th>Categoría</th>
            <th>EAN</th>
            <th>DUN14</th>
            <th style="color: #2d8b3c;">📊 Stock Actual</th>
            <th>Cajas</th>
            <th>Cant x Caja</th>
        </tr>
        {% for r in resultados %}
        <tr>
            <td>{{ r['sku'] }}</td>
            <td>{{ r['nombre'] }}</td>
            <td>{{ r['categoria'] }}</td>
            <td>{{ r['codigo_ean'] or '-' }}</td>
            <td>{{ r['dun14'] or '-' }}</td>
            <td><strong style="color: #2d8b3c;">{{ r['cantidad'] }}</strong></td>
            <td>
                {% if r['unidades_por_empaque'] %}
                    {{ (r['cantidad'] // r['unidades_por_empaque']) }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ r['unidades_por_empaque'] or '-' }}</td>
        </tr>
        {% endfor %}
    </table>
{% elif sku %}
    <p>No se encontró el SKU <strong>{{ sku }}</strong>.</p>
{% endif %}

<br>
<a href="{{ url_for('main.index') }}">
    <button>⏪ Volver al menú principal</button>
</a>
&nbsp;
<a href="{{ url_for('main.exportar_stock') }}">
    <button>📥 Exportar como Excel</button>
</a>

{% endblock %}
